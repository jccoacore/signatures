<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Block Tracker (A-K)</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 10px;
}

/* Header */
h2 {
  text-align: center;
  font-size: 20px;
}

.stats {
  text-align: center;
  margin-bottom: 10px;
  font-size: 14px;
  font-weight: bold;
}

/* Compact input */
textarea {
  width: 100%;
  height: 50px;
  padding: 6px;
  font-size: 14px;
}

button {
  padding: 6px 10px;
  font-size: 14px;
  margin-top: 5px;
}

/* Responsive Grid */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 8px;
  margin-top: 15px;
}

/* Block column */
.column {
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
}

/* Block header */
.column h4 {
  text-align: center;
  background: #f0f0f0;
  margin: 0;
  padding: 4px;
  font-size: 13px;
}

/* Compact cell */
.cell {
  padding: 4px;
  font-size: 12px;
  border-bottom: 1px solid #eee;
  text-align: center;
  cursor: pointer;
}

/* Owner / Tenant colors */
.owner { color: black; }
.tenant { color: red; }

/* Completed style */
.completed {
  background: #1976d2;
  color: white !important;
}

/* Remove bottom border for last item */
.column .cell:last-child {
  border-bottom: none;
}
</style>
</head>
<body>

<h2>Block Completion Tracker (A-K)</h2>

<div class="stats">
Total: <span id="totalCount">0</span> |
Completed: <span id="completedCount">0</span>
</div>

<textarea id="inputData" placeholder="Enter:
A 101
C 502"></textarea>
<br>
<button onclick="markCompleted()">Mark Completed</button>

<div class="grid" id="grid"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, updateDoc, doc, onSnapshot } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ðŸ”´ YOUR CONFIG HERE */
const firebaseConfig = {
  apiKey: "AIzaSyBlmrGDdGBR2VItLa5iNqvy_GyC1Tp-YG4",
  authDomain: "jcc-block-manager.firebaseapp.com",
  projectId: "jcc-block-manager",
  storageBucket: "jcc-block-manager.firebasestorage.app",
  messagingSenderId: "1013753394181",
  appId: "1:1013753394181:web:1c0a826908e3345877186c",
  measurementId: "G-PN4D1DEF5N"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const VALID_BLOCKS = ["A","B","C","D","E","F","G","H","I","J","K"];
const grid = document.getElementById("grid");

function render(data) {

  grid.innerHTML = "";

  let completedCounter = 0;
  let totalCounter = 0;

  const blocks = {};
  VALID_BLOCKS.forEach(letter => blocks[letter] = []);

  data.forEach(item=>{
    if(VALID_BLOCKS.includes(item.block)){
      blocks[item.block].push(item);
      totalCounter++;
      if(item.completed) completedCounter++;
    }
  });

  document.getElementById("completedCount").innerText = completedCounter;
  document.getElementById("totalCount").innerText = totalCounter;

  VALID_BLOCKS.forEach(letter=>{
    blocks[letter].sort((a,b)=>a.number-b.number);

    const col=document.createElement("div");
    col.className="column";
    col.innerHTML="<h4>"+letter+"</h4>";

    blocks[letter].forEach(entry=>{
      const cell=document.createElement("div");

      let occupantClass = entry.occupant === "Tenant" ? "tenant" : "owner";

      cell.className = "cell " + occupantClass;
      if(entry.completed) cell.classList.add("completed");

      cell.innerText=letter+" "+entry.number;

      col.appendChild(cell);
    });

    grid.appendChild(col);
  });
}

window.markCompleted = async function(){
  const input=document.getElementById("inputData").value.trim();
  if(!input) return;

  const lines=input.split("\n");

  onSnapshot(collection(db,"flats"),snapshot=>{
    snapshot.forEach(async d=>{
      const data=d.data();

      lines.forEach(async line=>{
        const parts=line.trim().split(/\s+/);
        if(parts.length<2) return;

        const block=parts[0].toUpperCase();
        const number=parseInt(parts[1]);

        if(data.block===block && data.number===number){
          await updateDoc(doc(db,"flats",d.id),{
            completed:true
          });
        }
      });
    });
  });

  document.getElementById("inputData").value="";
}

onSnapshot(collection(db,"flats"),snapshot=>{
  const data=[];
  snapshot.forEach(doc=>{
    data.push({id:doc.id,...doc.data()});
  });
  render(data);
});
</script>

</body>
</html>
