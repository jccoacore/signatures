<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Block Tracker â€” JCC</title>
  <meta name="description" content="Track flat completion status across residential blocks in real-time.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <style>
    /* â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg-primary: #f0f2f5;
      --bg-secondary: #ffffff;
      --bg-card: rgba(255, 255, 255, 0.85);
      --bg-card-hover: rgba(255, 255, 255, 1);
      --glass: rgba(255, 255, 255, 0.7);
      --glass-border: rgba(0, 0, 0, 0.08);
      --text-primary: #1a1a2e;
      --text-secondary: #555770;
      --text-muted: #8e90a6;
      --accent-blue: #4f6df5;
      --accent-purple: #8b5cf6;
      --accent-green: #10b981;
      --accent-orange: #f59e0b;
      --accent-red: #ef4444;
      --gradient-primary: linear-gradient(135deg, #4f6df5 0%, #8b5cf6 100%);
      --gradient-green: linear-gradient(135deg, #10b981 0%, #34d399 100%);
      --gradient-orange: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 20px rgba(0, 0, 0, 0.08);
      --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.1);
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 25% 15%, rgba(79, 109, 245, 0.06) 0%, transparent 50%),
        radial-gradient(circle at 75% 85%, rgba(139, 92, 246, 0.04) 0%, transparent 50%);
      z-index: 0;
      pointer-events: none;
    }

    /* â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.15);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.25);
    }

    /* â”€â”€ Login Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #login {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.02);
      }
    }

    .login-card {
      background: var(--bg-secondary);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-xl);
      padding: 48px 40px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
      backdrop-filter: blur(20px);
    }

    .login-card .logo {
      width: 56px;
      height: 56px;
      background: var(--gradient-primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 800;
      margin: 0 auto 24px;
      color: white;
      box-shadow: 0 4px 16px rgba(79, 109, 245, 0.35);
    }

    .login-card h2 {
      text-align: center;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 6px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .login-card .subtitle {
      text-align: center;
      color: var(--text-secondary);
      font-size: 13px;
      margin-bottom: 32px;
    }

    .input-group {
      margin-bottom: 16px;
    }

    .input-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .input-group input {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg-primary);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      transition: var(--transition);
      outline: none;
    }

    .input-group input:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(79, 109, 245, 0.12);
      background: #fff;
    }

    .input-group input::placeholder {
      color: var(--text-muted);
    }

    .btn-primary {
      width: 100%;
      padding: 12px;
      background: var(--gradient-primary);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-size: 14px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 8px;
      box-shadow: 0 4px 14px rgba(79, 109, 245, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(79, 109, 245, 0.35);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    #loginError {
      color: var(--accent-red);
      font-size: 12px;
      text-align: center;
      margin-top: 12px;
      min-height: 18px;
    }

    /* â”€â”€ App Container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #app {
      display: none;
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px 24px 40px;
      animation: fadeIn 0.5s ease;
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--glass-border);
    }

    .app-header .brand {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .app-header .brand-icon {
      width: 40px;
      height: 40px;
      background: var(--gradient-primary);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      color: white;
    }

    .app-header h2 {
      font-size: 22px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .user-badge {
      font-size: 12px;
      color: var(--text-secondary);
      background: var(--bg-card);
      padding: 6px 14px;
      border-radius: 20px;
      border: 1px solid var(--glass-border);
    }

    .btn-logout {
      padding: 8px 16px;
      background: rgba(239, 68, 68, 0.08);
      border: 1px solid rgba(239, 68, 68, 0.2);
      border-radius: var(--radius-sm);
      color: var(--accent-red);
      font-size: 12px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-logout:hover {
      background: rgba(239, 68, 68, 0.14);
      border-color: rgba(239, 68, 68, 0.35);
    }

    /* â”€â”€ Stats Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stat-box {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .stat-item {
      flex: 1;
      min-width: 90px;
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      padding: 10px 12px;
      border-radius: var(--radius-md);
      backdrop-filter: blur(10px);
      transition: var(--transition);
    }

    .stat-item:hover {
      background: var(--bg-card-hover);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .stat-item .stat-label {
      font-size: 10px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 2px;
    }

    .stat-item .stat-value {
      font-size: 18px;
      font-weight: 700;
    }

    .stat-item:nth-child(1) .stat-value {
      color: var(--text-primary);
    }

    .stat-item:nth-child(2) .stat-value {
      color: var(--accent-blue);
    }

    .stat-item:nth-child(3) .stat-value {
      color: var(--accent-green);
    }

    .stat-item:nth-child(4) .stat-value {
      color: var(--accent-orange);
    }

    .stat-item:nth-child(5) .stat-value {
      color: var(--accent-purple);
    }

    /* â”€â”€ Overall Progress â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .progress-container {
      height: 6px;
      background: rgba(0, 0, 0, 0.06);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 14px;
      position: relative;
    }

    .progress-bar {
      height: 6px;
      background: var(--gradient-primary);
      border-radius: 10px;
      transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%);
      }

      100% {
        transform: translateX(100%);
      }
    }

    /* â”€â”€ Block Summary Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #blockSummary {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }

    .summary-card {
      min-width: 70px;
      flex: 1;
      padding: 8px 6px;
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      font-size: 10px;
      text-align: center;
      cursor: pointer;
      background: var(--bg-card);
      backdrop-filter: blur(10px);
      transition: var(--transition);
      user-select: none;
    }

    .summary-card:hover {
      background: var(--bg-card-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-sm);
    }

    .summary-card.active {
      border-color: var(--accent-blue);
      background: rgba(79, 109, 245, 0.06);
      box-shadow: 0 2px 12px rgba(79, 109, 245, 0.1);
    }

    .summary-card.inactive {
      opacity: 0.3;
      filter: grayscale(0.5);
    }

    .summary-card .card-letter {
      font-size: 14px;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 2px;
    }

    .summary-card .card-percent {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 1px;
    }

    .summary-card .card-count {
      font-size: 9px;
      color: var(--text-secondary);
    }

    .summary-card .card-ot {
      font-size: 8px;
      color: var(--text-muted);
      margin-top: 1px;
    }

    .summary-bar-bg {
      height: 3px;
      background: rgba(0, 0, 0, 0.06);
      margin-top: 4px;
      border-radius: 2px;
      overflow: hidden;
    }

    .summary-bar-fill {
      height: 3px;
      background: var(--gradient-green);
      border-radius: 2px;
      transition: width 0.5s ease;
    }

    /* â”€â”€ Search â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .search-wrapper {
      position: relative;
      margin-bottom: 12px;
    }

    .search-wrapper::before {
      content: 'ğŸ”';
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 14px;
      opacity: 0.5;
    }

    #searchBox {
      width: 100%;
      padding: 11px 16px 11px 40px;
      background: #fff;
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 13px;
      font-family: 'Inter', sans-serif;
      transition: var(--transition);
      outline: none;
    }

    #searchBox:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(79, 109, 245, 0.1);
      background: #fff;
    }

    #searchBox::placeholder {
      color: var(--text-muted);
    }

    /* â”€â”€ Filter Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .filter-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .filter-btn {
      padding: 7px 14px;
      font-size: 11px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
    }

    .filter-btn:hover {
      background: var(--bg-card-hover);
      color: var(--text-primary);
      border-color: rgba(0, 0, 0, 0.15);
    }

    .filter-btn.active {
      background: var(--gradient-primary);
      color: white;
      border-color: transparent;
      box-shadow: 0 2px 10px rgba(79, 109, 245, 0.25);
    }

    /* â”€â”€ Textarea & Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #inputData {
      width: 100%;
      min-height: 60px;
      padding: 10px 14px;
      background: #fff;
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-size: 12px;
      font-family: 'Inter', monospace;
      resize: vertical;
      outline: none;
      transition: var(--transition);
      margin-bottom: 12px;
    }

    #inputData:focus {
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(79, 109, 245, 0.1);
    }

    #inputData::placeholder {
      color: var(--text-muted);
    }

    .action-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .btn-action {
      padding: 9px 18px;
      font-size: 12px;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      border: none;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .btn-action:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn-action:active {
      transform: translateY(0);
    }

    .btn-mark {
      background: var(--gradient-green);
      color: #064e3b;
    }

    .btn-unmark {
      background: var(--gradient-orange);
      color: #78350f;
    }

    .btn-clear {
      background: rgba(0, 0, 0, 0.04);
      color: var(--text-secondary);
      border: 1px solid var(--glass-border);
    }

    .btn-clear:hover {
      background: rgba(0, 0, 0, 0.08);
      color: var(--text-primary);
    }

    .btn-clipboard {
      background: rgba(16, 185, 129, 0.08);
      color: var(--accent-green);
      border: 1px solid rgba(16, 185, 129, 0.2);
    }

    .btn-clipboard:hover {
      background: rgba(16, 185, 129, 0.15);
    }

    .btn-download {
      background: rgba(79, 109, 245, 0.08);
      color: var(--accent-blue);
      border: 1px solid rgba(79, 109, 245, 0.2);
    }

    .btn-download:hover {
      background: rgba(79, 109, 245, 0.15);
    }

    .btn-refresh {
      background: rgba(139, 92, 246, 0.08);
      color: var(--accent-purple);
      border: 1px solid rgba(139, 92, 246, 0.2);
    }

    .btn-refresh:hover {
      background: rgba(139, 92, 246, 0.15);
    }

    /* â”€â”€ Toast Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      padding: 12px 20px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 500;
      color: white;
      z-index: 9999;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast-success {
      background: linear-gradient(135deg, #059669, #34d399);
      box-shadow: 0 4px 14px rgba(52, 211, 153, 0.4);
    }

    .toast-error {
      background: linear-gradient(135deg, #dc2626, #f87171);
      box-shadow: 0 4px 14px rgba(248, 113, 113, 0.4);
    }

    .toast-info {
      background: var(--gradient-primary);
      box-shadow: 0 4px 14px rgba(110, 142, 251, 0.4);
    }

    /* â”€â”€ Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .grid {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 6px;
    }

    .column {
      background: var(--bg-card);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      overflow: hidden;
      transition: var(--transition);
    }

    .column:hover {
      border-color: rgba(0, 0, 0, 0.15);
      box-shadow: var(--shadow-sm);
    }

    .column h4 {
      margin: 0;
      padding: 6px 4px;
      font-size: 10px;
      font-weight: 700;
      background: rgba(0, 0, 0, 0.02);
      text-align: center;
      color: var(--text-primary);
      letter-spacing: 0.3px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 4px;
    }

    .column h4 .col-percent {
      font-size: 8px;
      font-weight: 600;
      padding: 1px 5px;
      border-radius: 8px;
      background: var(--gradient-primary);
      color: white;
    }

    .block-progress-bg {
      height: 2px;
      background: rgba(0, 0, 0, 0.06);
    }

    .block-progress-fill {
      height: 2px;
      background: var(--gradient-green);
      transition: width 0.5s ease;
    }

    .cell {
      padding: 4px 3px;
      font-size: 9px;
      text-align: center;
      border-bottom: 1px solid rgba(0, 0, 0, 0.04);
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 3px;
      transition: var(--transition);
      user-select: none;
    }

    .cell:last-child {
      border-bottom: none;
    }

    .cell:hover {
      background: rgba(79, 109, 245, 0.04);
    }

    .cell .flat-num {
      font-weight: 500;
    }

    .owner .flat-num {
      color: var(--text-primary);
    }

    .tenant .flat-num {
      color: var(--accent-orange);
    }

    .badge {
      font-weight: 700;
      font-size: 8px;
      padding: 1px 4px;
      border-radius: 3px;
      letter-spacing: 0.3px;
    }

    .owner-badge {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-green);
    }

    .tenant-badge {
      background: rgba(245, 158, 11, 0.1);
      color: var(--accent-orange);
    }

    .completed {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0) !important;
      border-left: 3px solid #10b981;
    }

    .completed .flat-num {
      color: #047857 !important;
      font-weight: 700;
    }

    .completed .badge {
      opacity: 0.9;
    }

    .selected {
      background: linear-gradient(135deg, #fef3c7, #fde68a) !important;
      border-left: 3px solid var(--accent-orange);
    }

    .selected .flat-num {
      color: #b45309 !important;
      font-weight: 700;
    }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 1200px) {
      .grid {
        grid-template-columns: repeat(6, 1fr);
        gap: 6px;
      }
    }

    @media (max-width: 768px) {
      #app {
        padding: 10px 10px 24px;
      }

      .app-header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
        margin-bottom: 16px;
        padding-bottom: 14px;
      }

      .app-header h2 {
        font-size: 18px;
      }

      .stat-box {
        gap: 6px;
        margin-bottom: 10px;
      }

      .stat-item {
        min-width: 60px;
        padding: 8px 8px;
      }

      .stat-item .stat-label {
        font-size: 9px;
        letter-spacing: 0.5px;
      }

      .stat-item .stat-value {
        font-size: 16px;
      }

      .summary-card {
        min-width: 55px;
        padding: 6px 4px;
      }

      .summary-card .card-letter {
        font-size: 12px;
      }

      .summary-card .card-percent {
        font-size: 10px;
      }

      .summary-card .card-count {
        font-size: 8px;
      }

      .summary-card .card-ot {
        display: none;
      }

      .grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 5px;
      }

      .filter-row {
        gap: 4px;
        margin-bottom: 10px;
      }

      .filter-btn {
        padding: 5px 10px;
        font-size: 10px;
      }

      .action-row {
        gap: 5px;
        margin-bottom: 14px;
      }

      .btn-action {
        padding: 7px 10px;
        font-size: 10px;
      }

      #inputData {
        min-height: 40px;
        font-size: 11px;
        margin-bottom: 8px;
      }
    }

    @media (max-width: 480px) {
      .login-card {
        padding: 32px 24px;
      }

      .stat-box {
        gap: 4px;
      }

      .stat-item {
        min-width: 50px;
        padding: 6px 6px;
      }

      .stat-item .stat-value {
        font-size: 14px;
      }

      #blockSummary {
        gap: 4px;
        margin-bottom: 8px;
      }

      .summary-card {
        min-width: 45px;
        padding: 5px 3px;
      }

      .summary-card .card-letter {
        font-size: 11px;
      }

      .summary-card .card-percent {
        font-size: 9px;
      }

      .grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
      }

      .cell {
        padding: 4px 2px;
        font-size: 9px;
        gap: 2px;
      }

      .badge {
        font-size: 7px;
        padding: 1px 3px;
      }

      .column h4 {
        padding: 5px 3px;
        font-size: 9px;
      }

      .column h4 .col-percent {
        font-size: 7px;
        padding: 1px 4px;
      }
    }

    @media (max-width: 360px) {
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="login">
    <div class="login-card">
      <div class="logo">BT</div>
      <h2>Block Tracker</h2>
      <p class="subtitle">Sign in to manage your blocks</p>

      <div class="input-group">
        <label for="emailInput">Email</label>
        <input type="email" id="emailInput" placeholder="you@example.com">
      </div>

      <div class="input-group">
        <label for="passwordInput">Password</label>
        <input type="password" id="passwordInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>

      <button class="btn-primary" id="loginBtn">Sign In</button>
      <p id="loginError"></p>
    </div>
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="app">

    <!-- Header -->
    <div class="app-header">
      <div class="brand">
        <div class="brand-icon">BT</div>
        <h2>Block Tracker</h2>
      </div>
      <div class="header-right">
        <span class="user-badge" id="userEmail"></span>
        <button class="btn-logout" id="logoutBtn">Sign Out</button>
      </div>
    </div>

    <!-- Stats -->
    <div class="stat-box">
      <div class="stat-item">
        <div class="stat-label">Total Flats</div>
        <div class="stat-value" id="socTotal">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Completed</div>
        <div class="stat-value" id="socCompleted">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Owners</div>
        <div class="stat-value" id="socOwners">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Tenants</div>
        <div class="stat-value" id="socTenants">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Progress</div>
        <div class="stat-value" id="socPercent">0%</div>
      </div>
    </div>

    <!-- Overall Progress -->
    <div class="progress-container">
      <div id="overallBar" class="progress-bar"></div>
    </div>

    <!-- Block Summary -->
    <div id="blockSummary"></div>

    <!-- Search -->
    <div class="search-wrapper">
      <input type="text" id="searchBox" placeholder="Search flat number...">
    </div>

    <!-- Filters -->
    <div class="filter-row">
      <button class="filter-btn active" data-filter="ALL">All</button>
      <button class="filter-btn" data-filter="OWNER">Owners</button>
      <button class="filter-btn" data-filter="TENANT">Tenants</button>
      <button class="filter-btn" data-filter="COMPLETED">Completed</button>
      <button class="filter-btn" data-filter="PENDING">Pending</button>
      <button class="filter-btn" data-filter="OWNER_COMPLETED">Owner + Done</button>
      <button class="filter-btn" data-filter="OWNER_PENDING">Owner + Pending</button>
      <button class="filter-btn" data-filter="TENANT_COMPLETED">Tenant + Done</button>
      <button class="filter-btn" data-filter="TENANT_PENDING">Tenant + Pending</button>
    </div>

    <!-- Selection textarea -->
    <textarea id="inputData" placeholder="Selected flats will appear here..."></textarea>

    <!-- Action buttons -->
    <div class="action-row">
      <button class="btn-action btn-mark" id="markBtn">âœ“ Mark Completed</button>
      <button class="btn-action btn-unmark" id="unmarkBtn">âœ— Unmark</button>
      <button class="btn-action btn-clear" id="clearBtn">Clear Selection</button>
      <button class="btn-action btn-clipboard" id="copyStatusBtn">ğŸ“‹ Copy Status</button>
      <button class="btn-action btn-download" id="downloadBtn">â¬‡ Download CSV</button>
      <button class="btn-action btn-refresh" id="refreshBtn">â†» Refresh</button>
    </div>

    <!-- Grid -->
    <div class="grid" id="grid"></div>
  </div>

  <!-- Toast container -->
  <div id="toast" class="toast"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, updateDoc, doc, onSnapshot, getDocs }
      from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    document.addEventListener("DOMContentLoaded", () => {

      const firebaseConfig = {
        apiKey: "AIzaSyBlmrGDdGBR2VItLa5iNqvy_GyC1Tp-YG4",
        authDomain: "jcc-block-manager.firebaseapp.com",
        projectId: "jcc-block-manager"
      };

      const fbApp = initializeApp(firebaseConfig);
      const auth = getAuth(fbApp);
      const db = getFirestore(fbApp);

      const VALID_BLOCKS = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K"];

      let fullData = [];
      let selectedFlats = new Set();
      let activeBlocks = new Set(VALID_BLOCKS);
      let activeFilter = "ALL";
      let searchTerm = "";

      const loginDiv = document.getElementById("login");
      const appDiv = document.getElementById("app");
      const loginBtn = document.getElementById("loginBtn");
      const logoutBtn = document.getElementById("logoutBtn");
      const loginError = document.getElementById("loginError");
      const userEmail = document.getElementById("userEmail");
      const emailInput = document.getElementById("emailInput");
      const passwordInput = document.getElementById("passwordInput");
      const grid = document.getElementById("grid");
      const inputData = document.getElementById("inputData");

      /* â”€â”€ Toast helper â”€â”€ */
      function showToast(message, type = "info") {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = "toast toast-" + type + " show";
        setTimeout(() => toast.classList.remove("show"), 2800);
      }

      /* â”€â”€ AUTH â”€â”€ */
      loginBtn.addEventListener("click", async () => {
        try {
          loginError.innerText = "";
          await signInWithEmailAndPassword(auth, emailInput.value.trim(), passwordInput.value.trim());
        } catch (err) {
          loginError.innerText = err.message;
        }
      });

      // Allow pressing Enter to login
      passwordInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") loginBtn.click();
      });

      logoutBtn.addEventListener("click", () => signOut(auth));

      /* â”€â”€ MARK COMPLETED â”€â”€ */
      document.getElementById("markBtn").addEventListener("click", async () => {
        if (selectedFlats.size === 0) {
          showToast("No flats selected", "error");
          return;
        }
        try {
          const promises = [];
          for (const flatKey of selectedFlats) {
            const entry = fullData.find(f => (f.block + " " + f.number) === flatKey);
            if (entry && !entry.completed) {
              promises.push(updateDoc(doc(db, "flats", entry.id), { completed: true }));
            }
          }
          await Promise.all(promises);
          showToast(`Marked ${promises.length} flat(s) completed`, "success");
          selectedFlats.clear();
          inputData.value = "";
        } catch (err) {
          showToast("Error: " + err.message, "error");
        }
      });

      /* â”€â”€ UNMARK COMPLETED â”€â”€ */
      document.getElementById("unmarkBtn").addEventListener("click", async () => {
        if (selectedFlats.size === 0) {
          showToast("No flats selected", "error");
          return;
        }
        try {
          const promises = [];
          for (const flatKey of selectedFlats) {
            const entry = fullData.find(f => (f.block + " " + f.number) === flatKey);
            if (entry && entry.completed) {
              promises.push(updateDoc(doc(db, "flats", entry.id), { completed: false }));
            }
          }
          await Promise.all(promises);
          showToast(`Unmarked ${promises.length} flat(s)`, "success");
          selectedFlats.clear();
          inputData.value = "";
        } catch (err) {
          showToast("Error: " + err.message, "error");
        }
      });

      /* â”€â”€ CLEAR SELECTION â”€â”€ */
      document.getElementById("clearBtn").addEventListener("click", () => {
        selectedFlats.clear();
        inputData.value = "";
        render();
        showToast("Selection cleared", "info");
      });

      /* â”€â”€ DOWNLOAD CSV â”€â”€ */
      document.getElementById("downloadBtn").addEventListener("click", downloadSnapshot);

      /* â”€â”€ REFRESH â”€â”€ */
      document.getElementById("refreshBtn").addEventListener("click", async () => {
        await manualReload();
        showToast("Data refreshed", "info");
      });

      /* â”€â”€ REALTIME LISTENER (managed by auth state) â”€â”€ */
      let unsubscribeSnapshot = null;

      function startRealtimeListener() {
        // Unsubscribe any existing listener first
        if (unsubscribeSnapshot) {
          unsubscribeSnapshot();
          unsubscribeSnapshot = null;
        }
        unsubscribeSnapshot = onSnapshot(collection(db, "flats"), snap => {
          fullData = [];
          snap.forEach(d => {
            const data = d.data();
            if (VALID_BLOCKS.includes(data.block)) {
              fullData.push({ id: d.id, ...data });
            }
          });
          render();
        }, (error) => {
          console.error("Firestore listener error:", error);
          showToast("Error loading data. Please refresh.", "error");
        });
      }

      function stopRealtimeListener() {
        if (unsubscribeSnapshot) {
          unsubscribeSnapshot();
          unsubscribeSnapshot = null;
        }
        fullData = [];
        render();
      }

      /* â”€â”€ AUTH STATE â€” controls when listener starts/stops â”€â”€ */
      onAuthStateChanged(auth, user => {
        if (user) {
          loginDiv.style.display = "none";
          appDiv.style.display = "block";
          userEmail.innerText = user.email;
          // Start listening only after user is authenticated
          startRealtimeListener();
        } else {
          loginDiv.style.display = "flex";
          appDiv.style.display = "none";
          // Stop listening when user logs out
          stopRealtimeListener();
        }
      });

      /* â”€â”€ SEARCH â”€â”€ */
      document.getElementById("searchBox")
        .addEventListener("input", e => {
          searchTerm = e.target.value.trim();
          render();
        });

      /* â”€â”€ FILTER BUTTONS â”€â”€ */
      document.querySelectorAll(".filter-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          activeFilter = btn.dataset.filter;
          render();
        });
      });

      /* â”€â”€ FILTER LOGIC â”€â”€ */
      function applyFilter(data) {
        let d = data.filter(x => activeBlocks.has(x.block));
        switch (activeFilter) {
          case "OWNER": d = d.filter(x => x.occupant === "Owner"); break;
          case "TENANT": d = d.filter(x => x.occupant === "Tenant"); break;
          case "COMPLETED": d = d.filter(x => x.completed); break;
          case "PENDING": d = d.filter(x => !x.completed); break;
          case "OWNER_COMPLETED": d = d.filter(x => x.occupant === "Owner" && x.completed); break;
          case "OWNER_PENDING": d = d.filter(x => x.occupant === "Owner" && !x.completed); break;
          case "TENANT_COMPLETED": d = d.filter(x => x.occupant === "Tenant" && x.completed); break;
          case "TENANT_PENDING": d = d.filter(x => x.occupant === "Tenant" && !x.completed); break;
        }
        if (searchTerm) d = d.filter(x => x.number.toString().includes(searchTerm));
        return d;
      }

      /* â”€â”€ RENDER â”€â”€ */
      function render() {
        renderStats();
        renderDashboard();
        grid.innerHTML = "";
        const filtered = applyFilter(fullData);

        VALID_BLOCKS.forEach(letter => {
          if (!activeBlocks.has(letter)) return;
          const flats = filtered.filter(f => f.block === letter);
          const total = fullData.filter(f => f.block === letter).length;
          const completed = fullData.filter(f => f.block === letter && f.completed).length;
          const percent = total ? Math.round((completed / total) * 100) : 0;

          const col = document.createElement("div");
          col.className = "column";
          col.style.animation = "slideUp 0.3s ease forwards";
          col.innerHTML = `
      <h4>${letter} <span style="color:var(--text-secondary);font-weight:400;">${completed}/${total}</span> <span class="col-percent">${percent}%</span></h4>
      <div class="block-progress-bg">
        <div class="block-progress-fill" style="width:${percent}%"></div>
      </div>
    `;

          flats.sort((a, b) => a.number - b.number).forEach(entry => {
            const key = entry.block + " " + entry.number;
            const badge = entry.occupant === "Owner" ? "O" : "T";

            const cell = document.createElement("div");
            cell.className = "cell " +
              (entry.completed ? "completed " : "") +
              (entry.occupant === "Tenant" ? "tenant" : "owner");

            if (selectedFlats.has(key)) cell.classList.add("selected");

            cell.innerHTML = `
        <span class="flat-num">${key}</span>
        <span class="badge ${badge === "O" ? "owner-badge" : "tenant-badge"}">${badge}</span>
      `;

            cell.onclick = () => toggleSelection(key);
            col.appendChild(cell);
          });

          grid.appendChild(col);
        });
      }

      /* â”€â”€ DASHBOARD â”€â”€ */
      function renderDashboard() {
        const container = document.getElementById("blockSummary");
        container.innerHTML = "";
        VALID_BLOCKS.forEach(letter => {
          const total = fullData.filter(f => f.block === letter).length;
          const completed = fullData.filter(f => f.block === letter && f.completed).length;
          const owners = fullData.filter(f => f.block === letter && f.occupant === "Owner").length;
          const tenants = fullData.filter(f => f.block === letter && f.occupant === "Tenant").length;
          const percent = total ? Math.round((completed / total) * 100) : 0;

          const card = document.createElement("div");
          card.className = "summary-card";
          if (activeBlocks.has(letter)) card.classList.add("active");
          else card.classList.add("inactive");

          card.innerHTML = `
      <div class="card-letter">${letter}</div>
      <div class="card-percent">${percent}%</div>
      <div class="card-count">${completed}/${total}</div>
      <div class="card-ot">O:${owners} T:${tenants}</div>
      <div class="summary-bar-bg">
        <div class="summary-bar-fill" style="width:${percent}%"></div>
      </div>
    `;

          card.onclick = () => {
            if (activeBlocks.has(letter)) activeBlocks.delete(letter);
            else activeBlocks.add(letter);
            render();
          };

          container.appendChild(card);
        });
      }

      function renderStats() {
        const total = fullData.length;
        const completed = fullData.filter(f => f.completed).length;
        const owners = fullData.filter(f => f.occupant === "Owner").length;
        const tenants = fullData.filter(f => f.occupant === "Tenant").length;
        const percent = total ? Math.round((completed / total) * 100) : 0;

        document.getElementById("socTotal").innerText = total;
        document.getElementById("socCompleted").innerText = completed;
        document.getElementById("socOwners").innerText = owners;
        document.getElementById("socTenants").innerText = tenants;
        document.getElementById("socPercent").innerText = percent + "%";
        document.getElementById("overallBar").style.width = percent + "%";
      }

      function toggleSelection(flat) {
        if (selectedFlats.has(flat)) selectedFlats.delete(flat);
        else selectedFlats.add(flat);
        inputData.value = Array.from(selectedFlats).join("\n");
        render();
      }

      async function manualReload() {
        const snap = await getDocs(collection(db, "flats"));
        fullData = [];
        snap.forEach(d => {
          const data = d.data();
          if (VALID_BLOCKS.includes(data.block)) {
            fullData.push({ id: d.id, ...data });
          }
        });
        render();
      }

      function downloadSnapshot() {
        let csv = "Block,Flat Number,Occupant Type,Completed\n";
        fullData.forEach(f => {
          csv += `${f.block},${f.number},${f.occupant},${f.completed}\n`;
        });
        const blob = new Blob([csv], { type: "text/csv" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "flats_snapshot.csv";
        link.click();
        showToast("CSV downloaded", "success");
      }

      /* â”€â”€ COPY STATUS TO CLIPBOARD â”€â”€ */
      document.getElementById("copyStatusBtn").addEventListener("click", async () => {
        if (fullData.length === 0) {
          showToast("No data to copy", "error");
          return;
        }

        const now = new Date();
        const dateStr = now.toLocaleDateString("en-IN", { day: "2-digit", month: "short", year: "numeric" });
        const timeStr = now.toLocaleTimeString("en-IN", { hour: "2-digit", minute: "2-digit", hour12: true });

        const totalAll = fullData.length;
        const completedAll = fullData.filter(f => f.completed).length;
        const pendingAll = totalAll - completedAll;
        const percentAll = totalAll ? Math.round((completedAll / totalAll) * 100) : 0;

        let lines = [];
        lines.push(`ğŸ¢ *JCC Block Tracker Status*`);
        lines.push(`ğŸ“… ${dateStr} | ğŸ• ${timeStr}`);
        lines.push(``);
        lines.push(`ğŸ“Š *Overall: ${completedAll}/${totalAll} (${percentAll}%)*`);
        lines.push(`âœ… Done: ${completedAll}  |  â³ Pending: ${pendingAll}`);
        lines.push(`${'â”'.repeat(28)}`);

        VALID_BLOCKS.forEach(letter => {
          const blockFlats = fullData.filter(f => f.block === letter);
          const total = blockFlats.length;
          if (total === 0) return;

          const completed = blockFlats.filter(f => f.completed).length;
          const pending = total - completed;
          const percent = Math.round((completed / total) * 100);
          const owners = blockFlats.filter(f => f.occupant === "Owner").length;
          const tenants = blockFlats.filter(f => f.occupant === "Tenant").length;
          const ownerDone = blockFlats.filter(f => f.occupant === "Owner" && f.completed).length;
          const tenantDone = blockFlats.filter(f => f.occupant === "Tenant" && f.completed).length;

          // Visual progress bar
          const filled = Math.round(percent / 10);
          const bar = 'â–“'.repeat(filled) + 'â–‘'.repeat(10 - filled);

          lines.push(``);
          lines.push(`ğŸ”· *Block ${letter}* â€” ${percent}%`);
          lines.push(`${bar}  ${completed}/${total}`);
          lines.push(`   ğŸ‘¤ Owners: ${ownerDone}/${owners} âœ…  |  ğŸ  Tenants: ${tenantDone}/${tenants} âœ…`);
          if (pending > 0) {
            const pendingFlats = blockFlats
              .filter(f => !f.completed)
              .sort((a, b) => a.number - b.number)
              .map(f => f.number);
            lines.push(`   â³ Pending (${pending}): ${pendingFlats.join(', ')}`);
          }
        });

        lines.push(``);
        lines.push(`${'â”'.repeat(28)}`);
        lines.push(`_Generated from Block Tracker_`);

        const text = lines.join('\n');

        try {
          await navigator.clipboard.writeText(text);
          showToast("Status copied to clipboard! ğŸ“‹", "success");
        } catch (err) {
          // Fallback for older browsers
          const textarea = document.createElement("textarea");
          textarea.value = text;
          textarea.style.position = "fixed";
          textarea.style.opacity = "0";
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand("copy");
          document.body.removeChild(textarea);
          showToast("Status copied to clipboard! ğŸ“‹", "success");
        }
      });

    });
  </script>

</body>

</html>
